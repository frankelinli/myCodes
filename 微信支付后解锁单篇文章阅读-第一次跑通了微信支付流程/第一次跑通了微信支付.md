# 微信支付 WordPress 简易模块（单篇文章付费解锁）

本模块是一个极简的微信支付实现，适用于 WordPress 站点的单篇文章付费解锁场景。  
它帮助我第一次实现了网站的微信支付功能，解决了内容变现的技术难题。

通过短代码包裹一段任意文字，作为付费阅读，读者扫码付费后刷新文章，能阅读全文。没有用户会员限制，直接扫码阅读。

当前的 pay-simple 逻辑就是“单一商品、单一价格、单一用途”，所以代码里价格是常量，订单表也只存 post_id、order_id、code_url，没有商品类型、金额、用户、有效期等字段。

- 支持微信扫码支付（Native模式）
- 每篇文章可单独付费解锁
- 支付成功后自动显示全文
- 支持 PC 和移动端（移动端引导到电脑扫码）
- 订单状态自动轮询
- 支持微信支付回调自动验签和订单状态更新
- 代码结构清晰，易于二次开发

## 文件说明

- `wechat-pay-simple.php`  
  主插件文件，包含所有支付逻辑、短代码、AJAX接口、回调处理、数据库订单记录等。

- `README.md`  
  本说明文档，介绍功能、用法和开发心得。

## 用法

1. 填写你的微信支付商户信息（APPID、MCHID、API密钥）到 `wechat-pay-simple.php` 顶部。
2. 在文章内容中使用短代码 `[pay_content]这里是付费内容[/pay_content]`。
3. 用户访问文章时，未支付则显示二维码，扫码支付后自动解锁全文。
4. 支付回调自动处理，无需人工干预。

## 技术要点

- 订单号自动生成，订单信息存入数据库
- 微信支付统一下单接口（V2）
- 签名校验、金额校验
- 支付回调自动更新订单状态
- 异步任务支持邮件通知等扩展
- 支持自定义回调 URL 重写，兼容微信商户平台配置

## 适用场景

- 内容付费、知识付费、单篇文章解锁
- 不需要复杂会员系统、无需 WooCommerce
- 仅需一套微信支付逻辑，快速上线变现

## 开发心得

本模块是我第一次独立实现微信支付功能，帮助网站内容实现了变现闭环。  
代码简洁易懂，适合个人开发者和小型站点参考或二次开发。

---

**打包建议：**

- 文件列表：
  - `wechat-pay-simple.php`
  - `README.md`

- 打包方式：直接压缩为 zip 或放到博客附件区。

---

如需升级为多商品/多会员方案，可在此基础上扩展商品目录和订单表结构。



## 未来可以升级开发

如果你要支持多个商品（比如月会员、年会员），只需做如下升级：

**核心思路：**

1. 商品目录（数组或配置）：定义不同商品的 product_id、价格（分）、名称、时长等。
2. 前端/短代码/接口传 product_id，服务端根据 product_id 查价格和描述，生成订单。
3. 订单表增加 product_id、amount（分）、status 等字段。
4. 微信支付逻辑完全复用，只是 total_fee、body、attach 参数动态生成。
5. 回调时根据订单 product_id 做不同的履约（比如会员开通/续期）。

**这样做的好处：**

- 只需维护一套微信支付逻辑（下单、回调、验签、状态流转），所有商品都能用。
- 以后扩展新商品/价格/权益，只需加一条配置，不用改支付代码。
- 订单、会员、内容解锁等业务逻辑都可以在回调/异步任务里按 product_id 分发处理。

**结论：**
你完全可以自己开发，脱离 WooCommerce，直接在现有 pay-simple 基础上升级为“多商品、统一支付逻辑”。
只要把价格、商品、履约解耦，微信支付部分只负责“收钱和回调”，业务层负责“发权益”。